<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.120.1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Morven's Life"><meta property="og:url" content="https://morven.life/posts/golang-module/"><link rel=canonical href=https://morven.life/posts/golang-module/><link rel=apple-touch-icon href=https://morven.life/favicon.ico><link rel=icon href=https://morven.life/favicon.ico><link rel=shortcut href=https://morven.life/favicon.ico><link rel=alternate type=application/atom+xml href=https://morven.life/index.xml title="Morven's Life"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/morven.life\/"},"articleSection":"posts","name":"Go 模块化编程","headline":"Go 模块化编程","description":"Go 语言在去年八月份发布的1.11版本中增加了对模块化编程的支持以及内置的基于模块的依赖管理工具。Go 语言的模块（module）是文件树中的包（package）的集合，其中模块根目录包含的 go.mod 文件定义了模块的导入路径（import path）、Go 语言的版本以及模块的其他依赖性要求。每个模块的依赖性要求被列为单独的一个模块路径并指定相应的模块版本，只有满足了所有依赖性要求的模块才能被成功构建。\n使用 Go 语言自带的模块化编程能力，就不需要将 Go 语言的代码放入到 $GOPATH\/src 中，也就是过去的 GOPATH 模式，实际上，我们可以在 $GOPATH\/src 外的任何目录下使用 go mod init 创建 Go 项目并初始化 Go 模块。\nNote: 为了兼容性，在 Go 语言1.11与1.12中，Go 命令仍然可以在旧的 GOPATH 模式下运行，从 Go 语言1.13开始，模块模式(GO111MODULE=on)将成为默认模式。\nGOPATH 的前世今生 而 Go 语言支持模块化编程之前，一般我们的 Go 项目使用需要使用 GOPATH 模式，也就是说需要将 Go 语言的代码放入到 $GOPATH\/src 中。典型的 GOPATH 目录结构包含必须包含以下三个子文件夹：\nGOPATH ├── bin \/\/ binaries ├── pkg \/\/ cache |── src \/\/ go source code ├── github.com ├── rsc.io ... 使用 go get 命令获取依赖也会自动下载到 $GOPATH\/src 中：","inLanguage":"en-US","author":"Morven\u0027s Life","creator":"Morven\u0027s Life","publisher":"Morven\u0027s Life","accountablePerson":"Morven\u0027s Life","copyrightHolder":"Morven\u0027s Life","copyrightYear":"2019","datePublished":"2019-02-26 00:00:00 \u002b0000 UTC","dateModified":"2019-02-26 00:00:00 \u002b0000 UTC","url":"https:\/\/morven.life\/posts\/golang-module\/","keywords":[]}</script><title>Go 模块化编程</title>
<meta property="og:title" content="Go 模块化编程"><meta property="og:type" content="article"><meta property="og:description" content="Go 语言在去年八月份发布的1.11版本中增加了对模块化编程的支持以及内置的基于模块的依赖管理工具。Go 语言的模块（module）是文件树中的包（package）的集合，其中模块根目录包含的 go.mod 文件定义了模块的导入路径（import path）、Go 语言的版本以及模块的其他依赖性要求。每个模块的依赖性要求被列为单独的一个模块路径并指定相应的模块版本，只有满足了所有依赖性要求的模块才能被成功构建。
使用 Go 语言自带的模块化编程能力，就不需要将 Go 语言的代码放入到 $GOPATH/src 中，也就是过去的 GOPATH 模式，实际上，我们可以在 $GOPATH/src 外的任何目录下使用 go mod init 创建 Go 项目并初始化 Go 模块。
Note: 为了兼容性，在 Go 语言1.11与1.12中，Go 命令仍然可以在旧的 GOPATH 模式下运行，从 Go 语言1.13开始，模块模式(GO111MODULE=on)将成为默认模式。
GOPATH 的前世今生 而 Go 语言支持模块化编程之前，一般我们的 Go 项目使用需要使用 GOPATH 模式，也就是说需要将 Go 语言的代码放入到 $GOPATH/src 中。典型的 GOPATH 目录结构包含必须包含以下三个子文件夹：
GOPATH ├── bin // binaries ├── pkg // cache |── src // go source code ├── github.com ├── rsc.io ... 使用 go get 命令获取依赖也会自动下载到 $GOPATH/src 中："><meta name=description content="Go 语言在去年八月份发布的1.11版本中增加了对模块化编程的支持以及内置的基于模块的依赖管理工具。Go 语言的模块（module）是文件树中的包（package）的集合，其中模块根目录包含的 go.mod 文件定义了模块的导入路径（import path）、Go 语言的版本以及模块的其他依赖性要求。每个模块的依赖性要求被列为单独的一个模块路径并指定相应的模块版本，只有满足了所有依赖性要求的模块才能被成功构建。
使用 Go 语言自带的模块化编程能力，就不需要将 Go 语言的代码放入到 $GOPATH/src 中，也就是过去的 GOPATH 模式，实际上，我们可以在 $GOPATH/src 外的任何目录下使用 go mod init 创建 Go 项目并初始化 Go 模块。
Note: 为了兼容性，在 Go 语言1.11与1.12中，Go 命令仍然可以在旧的 GOPATH 模式下运行，从 Go 语言1.13开始，模块模式(GO111MODULE=on)将成为默认模式。
GOPATH 的前世今生 而 Go 语言支持模块化编程之前，一般我们的 Go 项目使用需要使用 GOPATH 模式，也就是说需要将 Go 语言的代码放入到 $GOPATH/src 中。典型的 GOPATH 目录结构包含必须包含以下三个子文件夹：
GOPATH ├── bin // binaries ├── pkg // cache |── src // go source code ├── github.com ├── rsc.io ... 使用 go get 命令获取依赖也会自动下载到 $GOPATH/src 中："><meta property="og:locale" content="cn"><style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{background-color:#f8f8f8;border-left:2px solid;margin:40px;padding:10px 20px}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:85%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.signatures{font-family:permanent marker,Impact,Charcoal,sans-serif;font-size:3rem;margin-top:32px}.signatures a{text-decoration:none}.header-line{width:100%;height:3px;background-color:#000;margin:18px 0}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-date,.posts-title{font-size:1.2rem}.posts-line{margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px;margin-bottom:3px}.site-footer{margin-top:50px;margin-bottom:80px;display:flex;justify-content:flex-end;flex-wrap:wrap;padding:12px 0;border-width:3px;border-color:#000}.site-footer-item{margin-right:12px}@media screen and (max-width:600px){.site-header{display:none}.post-content{padding:0 12px}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}}.post-content img{max-width:100%;display:block;margin-left:auto;margin-right:auto;margin-top:12px}.post-header{margin-bottom:50px}.post-title{font-size:2.5rem;font-weight:600}.post-category{display:inline;font-weight:900;margin:0 4px;padding:2px 5px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}</style><style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style><link href=https://morven.life/index.xml rel=alternate type=application/rss+xml title="Morven's Life"><link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker|Bree+Serif" rel=stylesheet></head><body><article class="post 简体中文" id=article><div class=row><div class=col-xs-12><header class=post-header><h1 class=post-title>Go 模块化编程</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2019-02-26 00:00:00 UTC">26 Feb 2019</time></div><div class=col-xs-6><div class=post-author><a target=_blank href=https://morven.life/>@Morven's Life</a></div></div></div></header><div class="post-content markdown-body"><p>Go 语言在去年八月份发布的1.11版本中增加了对模块化编程的支持以及内置的基于模块的依赖管理工具。Go 语言的模块（module）是文件树中的包（package）的集合，其中模块根目录包含的 <code>go.mod</code> 文件定义了模块的导入路径（import path）、Go 语言的版本以及模块的其他依赖性要求。每个模块的依赖性要求被列为单独的一个模块路径并指定相应的模块版本，只有满足了所有依赖性要求的模块才能被成功构建。</p><p>使用 Go 语言自带的模块化编程能力，就不需要将 Go 语言的代码放入到 <code>$GOPATH/src</code> 中，也就是过去的 GOPATH 模式，实际上，我们可以在 <code>$GOPATH/src</code> 外的任何目录下使用 <code>go mod init</code> 创建 Go 项目并初始化 Go 模块。</p><blockquote><p>Note: 为了兼容性，在 Go 语言1.11与1.12中，Go 命令仍然可以在旧的 GOPATH 模式下运行，从 Go 语言1.13开始，模块模式(<code>GO111MODULE=on</code>)将成为默认模式。</p></blockquote><h2 id=gopath-的前世今生>GOPATH 的前世今生</h2><p>而 Go 语言支持模块化编程之前，一般我们的 Go 项目使用需要使用 GOPATH 模式，也就是说需要将 Go 语言的代码放入到 <code>$GOPATH/src</code> 中。典型的 GOPATH 目录结构包含必须包含以下三个子文件夹：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>GOPATH
</span></span><span style=display:flex><span>├── bin              // binaries
</span></span><span style=display:flex><span>├── pkg              // cache
</span></span><span style=display:flex><span>|── src              // go source code
</span></span><span style=display:flex><span>    ├── github.com
</span></span><span style=display:flex><span>    ├── rsc.io
</span></span><span style=display:flex><span>    ...
</span></span></code></pre></div><p>使用 <code>go get</code> 命令获取依赖也会自动下载到 <code>$GOPATH/src</code> 中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ go get rsc.io/quote <span style=color:#8f5902;font-style:italic># will be doloaded to $GOPATH/src/rsc.io/quote</span>
</span></span></code></pre></div><p>但是 GOPATH 模式存在问题，当我们使用 <code>go get</code> 获取某个依赖时没有指定版本，那么默认下载的依赖代码都会是最新版本，而且如果当项目 A 和 B 分别依赖项目 C 的两个不兼容版本时，GOPATH 路径下只有一个版本的 C 将无法同时满足项目 A 和 B 的依赖需求。这是令人棘手的缺陷，实际上，从 Go 1.13开始，官方就不再推荐使用 GOPATH 模式了。</p><p>另外，随着 Go 语言的普及，依赖包也变得越来越丰富，依赖管理的问题逐渐成为开发人员的焦点。GOPATH 模式衍生出了很多版本管理工具，但是他们的基本思路都是基于每个项目单独维护一份对应版本依赖的拷贝：</p><ol><li>最早官方在 Go 1.5版本提出的 vendor 特性：为每个 Go 项目创建一个 <code>vendor/</code> 目录来存放项目所需版本依赖的拷贝</li><li>社区则基于 vendor 特性，开发出了各种版本管理工具。比较流行的如 <a href=https://github.com/kardianos/govendor>govendor</a>，以及之前曾被官方认定的 <a href=https://github.com/golang/dep>godep</a> 等</li></ol><p>Go 依赖管理工具虽然丰富了起来，但是不同版本工具之间存在不兼容的问题，而且各种工具还都有学习成本，这时候开发者迫切需要一个统一的版本管理工具来解决这些问题。于是 Go 社区提出了 <a href=https://github.com/golang/go/wiki/vgo>vgo</a> 方案，随着 vgo 的逐渐发展成熟，Go 1.11发布了基于该方案的 Go module 功能，并集成到了 Go 语言的官方工具中。</p><h2 id=go-模块化支持的相关环境变量>Go 模块化支持的相关环境变量</h2><p>使用 Go 语言内置的模块化功能，开发者需要关心的6个环境变量，可以使用 <code>go env</code> 命令列出：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>GO111MODULE=&#34;auto&#34;
</span></span><span style=display:flex><span>GOPROXY=&#34;https://goproxy.io,direct&#34;
</span></span><span style=display:flex><span>GONOPROXY=&#34;&#34;
</span></span><span style=display:flex><span>GOSUMDB=&#34;sum.golang.org&#34;
</span></span><span style=display:flex><span>GONOSUMDB=&#34;&#34;
</span></span><span style=display:flex><span>GOPRIVATE=&#34;&#34;
</span></span></code></pre></div><ol><li>GO111MODULE</li></ol><p>该环境变量控制是否开启使用 Go 模块功能，可选的值以及说明如下表所示：</p><table><thead><tr><th>｜ 值</th><th>说明</th></tr></thead><tbody><tr><td>auto</td><td><code>$GOPATH/src</code> 之中的项目继续使用 GOPATH 模式；<code>$GOPATH/src</code> 之外的项目自动使用 Go 模块化模式 ｜</td></tr><tr><td>on</td><td>启用 Go 模块化模式，推荐使用 ｜</td></tr><tr><td>off</td><td>使用 GOPATH 模式，禁用 Go 模块化模式，不推荐设置 ｜</td></tr></tbody></table><p>开启 Go 模块化模式只需要设置 <code>GO111MODULE</code> 环境变量为 <code>on</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ go env -w <span style=color:#000>GO111MODULE</span><span style=color:#ce5c00;font-weight:700>=</span>on
</span></span></code></pre></div><ol start=2><li>GOPROXY</li></ol><p>该环境变量用于设置 Go 模块依赖下载的代理，这样 Go 在拉取模块依赖时直接通过代理站点来快速拉取。默认值是：<code>https://proxy.golang.org,direct/</code> 。但是由于国内无法直接访问，所以开启 Go 模块化模式需要设置代理地址，常用的国内镜像代理地址如下：</p><table><thead><tr><th>地址</th><th>简介</th></tr></thead><tbody><tr><td><code>https://goproxy.io</code></td><td>最早的 Go 模块镜像代理网站</td></tr><tr><td><code>https://mirrors.aliyun.com/goproxy/</code></td><td>阿里镜像代理网站</td></tr><tr><td><code>https://goproxy.cn</code></td><td>七牛云赞助的代理网站 ｜</td></tr></tbody></table><blockquote><p>Note: <code>GOPROXY</code> 环境变量的值是一个以英文逗号 <code>,</code> 分割的 Go 模块代理列表，允许设置多个模块代理；如果想关闭代理，可以设置为 <code>off</code></p></blockquote><p>默认值的逗号后面的 <code>direct</code> 用来告诉 Go 语言将直接从依赖的源地址进行下载，例如当值列表中的 Go 镜像代理返回<code>404</code>或<code>410</code>时，Go 自动尝试列表中的下一个，如果下个值是 <code>direct</code> 则到源地址去下载依赖的模块。</p><p>设置 Go 模块化镜像代理：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ go env -w <span style=color:#000>GOPROXY</span><span style=color:#ce5c00;font-weight:700>=</span>https://mirrors.aliyun.com/goproxy/,direct
</span></span></code></pre></div><ol start=3><li>GOSUMDB</li></ol><p>该环境变量的全称是 GO checkSUM DataBase，正如它的字面意思一样，它用于在拉取模块依赖时保证拉取到的模块版本数据未经过篡改，若发现不一致，则立即中止拉取并报错。
<code>GOSUMDB</code> 环境变量的默认值为：<code>sum.golang.org</code>，在国内也是无法访问的，好在设置好代理地址 <code>GOPROXY</code> 之后，<code>GOSUMDB</code> 也可以访问。如果将它的值若设为 <code>off</code>，就禁止 Go 命令在后续拉取模块依赖时进行校验，不推荐这样做。</p><ol start=4><li>GONOPROXY & GONOSUMDB & GOPRIVATE</li></ol><p>这三个环境变量主要在 Go 项目依赖于私有模块时使用，比如有些依赖存在于私有的 git 仓库，直接使用 <code>GOPROXY</code> 设置的镜像代理或 <code>GOSUMDB</code> 设置的检验站点会无法访问对应的私有仓库。这时候就需要设置这些依赖模块不经过镜像代理站点直接拉取校验。实际上，对于私有的依赖模块，最佳实践是直接设置 <code>GOPRIVATE</code> 环境变量，它的值将作为 <code>GONOPROXY</code> 和 <code>GONOSUMDB</code> 的默认值。</p><p>它们的值都是一个以英文逗号 <code>,</code> 分割的模块路径前缀，也就是可以设置多个，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ go env -w <span style=color:#000>GOPRIVATE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;*.my.com,github.com/eabc/def&#34;</span>
</span></span></code></pre></div><p>这项设置表示前缀为 <code>*.my.com</code> 和 <code>github.com/eabc/def</code> 的模块依赖都会被认为是私有模块，并不经过镜像代理站点直接拉取校验。</p><h2 id=go-模块化操作命令>Go 模块化操作命令</h2><ol><li><p><code>go mod init</code> 创建一个新模块，初始化描述它的 <code>go.mod</code> 文件</p></li><li><p><code>go build</code> & <code>go test</code> 和其他程序包构建命令根据需要向 <code>go.mod</code> 添加新的依赖项</p></li><li><p><code>go list -m all</code> 打印当前模块的所有依赖关系</p></li><li><p><code>go get</code> 更改所需依赖的版本（或添加新的依赖）</p></li><li><p><code>go mod tidy</code> 删除未使用的依赖项</p></li><li><p><code>go mod vendor</code> 从模块依赖的正确版本拷贝到项目的 vendor 目录</p></li><li><p>初始化模块</p></li></ol><p>我们可以在 <code>$GOPATH/src</code> 外的任何目录下使用 <code>go mod init</code> 创建 Go 项目并初始化 Go 模块：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ go mod init example.com/greetings
</span></span><span style=display:flex><span>go: creating new go.mod: module example.com/greetings
</span></span></code></pre></div><p>上述命令指定的参数 <code>example.com/greetings</code> 不仅是模块的标识，作为模块的导入路径，当其他 Go 项目引用这个模块下的某个包时都会以该导入路径作为共同的前缀，并加上该包相对于模块根目录的相对路径。</p><ol start=2><li><code>go.mod</code> 文件</li></ol><p>上面的命令成功执行之后就会在当前目录下面生成一个 <code>go.mod</code> 文件：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>module example.com/greetings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go 1.12
</span></span></code></pre></div><p>实际上，Go 模块化模式下，使用 <code>go get</code> 命令获取模块依赖之后，相关依赖信息可以自动记录到 <code>go.mod</code> 文件中：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ go get -u rsc.io/quote
</span></span></code></pre></div><p><code>go get</code> 命令默认下载最新的依赖版本，当然也可以通过 <code>@</code> 来指定版本管理的 tag 或者 commit id，例如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>$ go get -u rsc.io/quote@v1.5.2
</span></span></code></pre></div><p>使用 <code>go get</code> 命令拉取模块依赖之后会将结果缓存到 <code>$GOPATH/pkg/mod</code> 和 <code>$GOPATH/pkg/sumdb</code> 目录，而在 <code>$GOPATH/pkg/mod</code> 目录中模块依赖会以 <code>github.com/foo/bar</code> 的格式进行存放。</p><p>拉取模块依赖之后，<code>go.mod</code> 文件会变成：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>module example.com/greetings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go 1.12
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>require rsc.io/quote v1.5.2 // indirect
</span></span></code></pre></div><blockquote><p>Note: 其中，<code>indirect</code> 注释表示该模块为间接依赖，也就是在当前应用程序中的 <code>import</code> 语句中，并没有发现这个模块的明确引用。直接使用 <code>go get</code> 命令拉取模块依赖，而不是使用 <code>go build</code> 自动根据 <code>go.mod</code> 拉取模块依赖。</p></blockquote><p><code>go.mod</code> 文件中可以使用到的语法关键词以及含义：</p><ul><li><code>module</code> 定义当前项目的模块路径</li><li><code>go</code> 标识当前模块的Go语言版本</li><li><code>require</code> 说明模块依赖的版本</li><li><code>exclude</code> 用于从使用中排除一个特定的模块版本，如果某个版本的模块依赖有严重bug，则需要显式地排除某个版本，例如：<code>exclude github.com/google/uuid v1.1.0</code> 表示不使用 <code>v1.1.0</code> 版本</li><li><code>replace</code> 替换 <code>require</code> 中声明的模块依赖，使用另外的模块依赖及其版本</li></ul><p><code>replace</code> 关键词的使用场景：</p><p><strong>使用场景一：替换 require 的依赖包</strong></p><p>当前项目的 <code>go.mod</code> 文件如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>module example.com/greetings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go 1.12
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>require (
</span></span><span style=display:flex><span>    github.com/google/uuid v1.1.1
</span></span><span style=display:flex><span>    rsc.io/quote v1.5.2 // indirect
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exclude github.com/google/uuid v1.1.0
</span></span></code></pre></div><p>下执行命令 <code>go list -m all</code> 列出当前模块的所有依赖关系：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>example.com/greetings
</span></span><span style=display:flex><span>github.com/google/uuid v1.1.1
</span></span><span style=display:flex><span>rsc.io/quote v1.5.2
</span></span></code></pre></div><p>在 <code>go.mod</code> 文件下增加这样一句配置：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>replace github.com/google/uuid v1.1.1 =&gt; github.com/google/uuid v1.1.0
</span></span></code></pre></div><p>再次执行命令 <code>go list -m all</code> 列出当前模块的所有依赖关系：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>example.com/greetings
</span></span><span style=display:flex><span>github.com/google/uuid v1.1.1 =&gt; github.com/google/uuid v1.1.0
</span></span><span style=display:flex><span>rsc.io/quote v1.5.2
</span></span></code></pre></div><p>发现最终生效的模块依赖从 <code>github.com/google/uuid v1.1.1</code> 变成了 <code>github.com/google/uuid v1.1.0</code>。一般来说，这种场景使用的不多，和直接修改 <code>require</code> 作用相同，其生效有前提条件：</p><ul><li>当前引用的模块依赖有效</li><li><code>replace</code> 命令左侧的包名和版本，必须是<code>require</code>中包含的对应包名和版本</li></ul><p><strong>场景二：替换无法下载的包</strong></p><p>由于国内网络限制问题，有些模块依赖包无法下载，比如 <code>golang.org</code> 下的所有依赖包，好在这些依赖包在 GitHub 都有对应的镜像，此时就可以使用 GitHub 上的镜像包来替换 <code>golang.org</code> 导入路径下的模块依赖包。</p><p>比如，如果项目中使用了 <code>golang.org/x/net</code> 包：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>module example.com/greetings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go 1.12
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>require (
</span></span><span style=display:flex><span>    github.com/google/uuid v1.1.1
</span></span><span style=display:flex><span>    golang.org/x/net v0.3.2
</span></span><span style=display:flex><span>    rsc.io/quote v1.5.2 // indirect
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>replace golang.org/x/net v0.3.2 =&gt; github.com/golang/net v0.3.2
</span></span></code></pre></div><p>这样项目编译时就会从 GitHub 下载 <code>golang.org/x/net</code> 包，而在源代码中 <code>import</code> 路径 <code>golang.org/x/net/xxx</code> 则不需要改变。</p><p><strong>场景三：调试依赖包</strong></p><p>调试依赖包时可以使用 <code>replace</code> 来修改依赖，如下所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>replace (
</span></span><span style=display:flex><span>    github.com/google/uuid v1.1.1 =&gt; ../uuid
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>使用本地的 <code>uuid</code> 来替换依赖包，此时，我们可以任意地修改 <code>../uuid</code> 目录的内容来进行调试。除了使用相对路径，还可以使用绝对路径，甚至还可以使用自已 fork 出来的仓库。</p><p><strong>场景四：禁止被依赖</strong></p><p>最后一种使用 <code>replace</code> 指令的场景是不希望自己的模块被直接引用，比如 k8s 项目的 <code>go.mod</code> 文件中，<code>require</code> 部分有大量的 <code>v0.0.0</code> 依赖：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>module k8s.io/kubernetes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>require (
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  k8s.io/api v0.0.0
</span></span><span style=display:flex><span>  k8s.io/apiextensions-apiserver v0.0.0
</span></span><span style=display:flex><span>  k8s.io/apimachinery v0.0.0
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>由于上面的依赖都不存在 <code>v0.0.0</code> 版本，所以其他项目直接依赖 <code>k8s.io/kubernetes</code> 时会因无法找到版本而不能拉取成功。</p><p>因为 k8s 的核心仓库不希望自己作为模块依赖被直接使用，其他项目可以使用 k8s 项目的其他子组件。k8s 对外隐藏了依赖版本号，其真实的依赖通过 <code>replace</code> 指定：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>replace (
</span></span><span style=display:flex><span>  k8s.io/api =&gt; ./staging/src/k8s.io/api
</span></span><span style=display:flex><span>  k8s.io/apiextensions-apiserver =&gt; ./staging/src/k8s.io/apiextensions-apiserver
</span></span><span style=display:flex><span>  k8s.io/apimachinery =&gt; ./staging/src/k8s.io/apimachinery
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><ol start=3><li><code>go.sum</code> 文件</li></ol><p>在我们构建执行 <code>go build</code> 或者 <code>go test</code> 等命令后还会发现在项目的根目录下面生成了一个 <code>go.sum</code> 文件。它的主要用途是检验下载的模块依赖包。实际上，模块依赖包在下载过程中有可能被恶意篡改，缓存在本地的依赖包也有被篡改的可能，单单一个 <code>go.mod</code> 文件并不能保证一致性地构建，在 <code>go.mod</code> 的基础上同时也引入了 <code>go.sum</code> 文件，用于记录每个依赖包的哈希值，在构建 Go 项目时，如果本地的依赖包哈希校验值与 <code>go.sum</code> 文件中记录的不一致，则会拒绝构建。</p><p>一个典型的 <code>go.mod</code> 文件如下所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>github.com/google/uuid v1.0.0 h1:b4Gk+7WdP/d3HZH8EJsZpvV7EtDOgaZLtnaNGIu1adA=
</span></span><span style=display:flex><span>github.com/google/uuid v1.0.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=
</span></span></code></pre></div><p>正常情况下，每个依赖包版本会包含两条记录，第一条记录为该依赖包版本整体的哈希值，第二条记录仅表示该依赖包版本中 <code>go.mod</code> 文件的哈希值，如果该依赖包版本没有 <code>go.mod</code> 文件，则只有第一条记录。</p><p>那么 <code>go.sum</code> 是怎么生成的呢？</p><p>在 Go 项目的根目录中执行 <code>go get</code> 命令，它会同步更新 <code>go.mod</code> 和 <code>go.sum</code> 文件，<code>go.mod</code> 中记录的是依赖名及其版本，如：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>github.com/google/uuid v1.1.1
</span></span></code></pre></div><p><code>go.sum</code> 文件中则会记录依赖包的哈希值（同时还有依赖包中<code>go.mod</code>的哈希值）。在更新 <code>go.sum</code> 之前，为了确保下载的依赖包是真实可靠的，Go 命令在下载完依赖包后还会查询 <code>GOSUMDB</code> 环境变量所指示的服务器，以得到一个权威的依赖包版本哈希值。如果 Go 命令计算出的依赖包版本哈希值与 <code>GOSUMDB</code> 服务器给出的哈希值不一致，Go 命令将拒绝向下执行，也不会更新 <code>go.sum</code> 文件。</p><h2 id=go模块的使用与更新>Go模块的使用与更新</h2><p>我们首先使用 <code>go mod init</code> 命令初始化 Go 项目的模块并设置模块的导入路径，然后在我们写代码的时候先写好导入的包等，<code>go build</code> 或者 <code>go mod tidy</code> 等命令会自动下载相关导入包并更新 <code>go.mod</code> 与 <code>go.sum</code> 文件，这时候使用版本管理工具比如 Git 提交并管理项目源代码与更新后的 <code>go.mod</code> 与 <code>go.sum</code> 文件，确保每次的构建都可以得到一致的依赖关系。</p><ol><li>小版本更新</li></ol><p>使用 <code>go get -u</code> 命令会更新某个模块依赖最新的小版本，例如，它会将<code>1.0.0</code>更新为<code>1.0.1</code>或者<code>1.1.0</code>这样类似的版本；<code>go get -u=patch</code> 命令则是获取最新的patch更新，例如，它会将<code>1.0.0</code>更新到<code>1.0.1</code>而不是<code>1.1.0</code>版本：</p><p>假如我们的 Go 项目使用的是依赖包的<code>1.0.0</code>版本，并且该模块依赖刚刚更新了<code>1.0.1</code>版本，以下任何命令都会将我们的更新到模块依赖<code>1.0.1</code>版：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>go get -u
</span></span><span style=display:flex><span>go get -u<span style=color:#ce5c00;font-weight:700>=</span>patch
</span></span><span style=display:flex><span>go get github.com/example/testmod@v1.0.1
</span></span></code></pre></div><ol start=2><li>大版本更新</li></ol><p>一般来说，大版本完全不同于小版本，大版本可能会破坏向后兼容性。因此，从 Go 模块的角度来看，大版本是一个完全不同的包。一个库的两个不兼容的版本，实质上是两个不同的库。遇到大版本更新的时候，还是可以使用 tag 来更新，从<code>1.0.0</code>更新为<code>2.0.0</code>，但是一定要注意向后兼容性的问题。</p></div><div class="row middle-xs"><div class=col-xs-12><div class=post-category><a href=https://morven.life/categories/note/>note</a></div><div class=post-category><a href=https://morven.life/categories/tech/>tech</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=site-footer><div class=site-footer-item><a href=https://morven.life/about/ target=_blank>About Me</a></div></div></div></div></article><script src=https://morven.life/js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script></script></body></html>