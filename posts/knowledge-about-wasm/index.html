<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Morven's Life"><meta property="og:url" content="https://morven.life/posts/knowledge-about-wasm/"><link rel=canonical href=https://morven.life/posts/knowledge-about-wasm/><link rel=apple-touch-icon href=https://morven.life/favicon.ico><link rel=icon href=https://morven.life/favicon.ico><link rel=shortcut href=https://morven.life/favicon.ico><link rel=alternate type=application/atom+xml href=https://morven.life/index.xml title="Morven's Life"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/morven.life\/"},"articleSection":"posts","name":"关于 WebAssembly，我们需要知道的事","headline":"关于 WebAssembly，我们需要知道的事","description":"WebAssembly 是什么？ WebAssembly 简称 WASM，从字面上看，它是由 Web 和 Assembly 组成，可以理解为网络\/浏览器汇编，这也表明这项技术的由来，即运行在浏览器内的汇编代码。但是，随着技术的迭代，WebAssembly 早已不局限于它最初的设计愿景。\nWebAssembly 不完全是汇编语言，而是一种类似汇编字节码的指令格式标准，由 W3C 的 WASM 工作组和 ByteCode Aliance(字节码联盟)共同维护。它更像 LLVM-IR 那种比汇编语言更高一些抽象的中间语言，开发者不需要手写 WASM，而是选择使用其他高级语言（如 C、C\u002b\u002b、Rust、Go、Python等）编写并编译为 WASM。 WebAssembly 已经不只局限于运行在浏览器上面，如今随着 WASM 生态圈的不断扩展，涌现出了各种与 WASM 兼容的运行时，这些运行时的出现使得 WASM 可以运行在浏览器之外的客户端与服务器端这样的沙盒环境中。 为什么需要 WebAssembly ？ 不管是在浏览器还是 Node.js 这样的服务端中，JavaScript 都可以胜任，为什么还需要 WASM ？\n主要是因为 JavaScript 的性能问题，本质上，JavaScript 没有静态的变量类型，导致执行引擎所做的编译优化(JIT Compiler)很可能失效。举个例子，JavaScript 代码中定义了一个函数并且包含一个局部变量，开始是它被赋予 Array 类型的值，执行到下一行代码时它又被赋予 Object 类型的值，JIT 编译器所做的优化也就失效了。也正是因为 JavaScript 本身的设计缺陷，导致这门编程语言的发展史变成了填坑史，即使是围绕 JavaScript 的开发生态越来越庞大，它在面对大型复杂项目是还是有点儿捉襟见肘。\n当然，开发者为了解决 JavaScript 的性能问题也做了各种尝试，除了 WASM 还有一种优化 JavaScript 的优化子集：asm.js。与 WASM 一样，asm.js 也是一种编译目标，可读性比 WebAssembly 好，但是开发者必须强制使用静态类型，这导致并不是所有的开发者都能够接受；其次 acm.js 的代码还是需要经过“获取-解析-编译-优化”这些耗时的过程，而 WASM 则不用这些步骤，WASM 已经是原生的字节码，而且 WASM 也是静态类型的，这使得大多数优化在其初始编译时就已完成，所以 WebAssembly 比 asm.","inLanguage":"en-US","author":"Morven\u0027s Life","creator":"Morven\u0027s Life","publisher":"Morven\u0027s Life","accountablePerson":"Morven\u0027s Life","copyrightHolder":"Morven\u0027s Life","copyrightYear":"2023","datePublished":"2023-01-27 00:00:00 \u002b0000 UTC","dateModified":"2023-01-27 00:00:00 \u002b0000 UTC","url":"https:\/\/morven.life\/posts\/knowledge-about-wasm\/","keywords":[]}</script><title>关于 WebAssembly，我们需要知道的事</title><meta property="og:title" content="关于 WebAssembly，我们需要知道的事"><meta property="og:type" content="article"><meta property="og:description" content="WebAssembly 是什么？ WebAssembly 简称 WASM，从字面上看，它是由 Web 和 Assembly 组成，可以理解为网络/浏览器汇编，这也表明这项技术的由来，即运行在浏览器内的汇编代码。但是，随着技术的迭代，WebAssembly 早已不局限于它最初的设计愿景。
WebAssembly 不完全是汇编语言，而是一种类似汇编字节码的指令格式标准，由 W3C 的 WASM 工作组和 ByteCode Aliance(字节码联盟)共同维护。它更像 LLVM-IR 那种比汇编语言更高一些抽象的中间语言，开发者不需要手写 WASM，而是选择使用其他高级语言（如 C、C++、Rust、Go、Python等）编写并编译为 WASM。 WebAssembly 已经不只局限于运行在浏览器上面，如今随着 WASM 生态圈的不断扩展，涌现出了各种与 WASM 兼容的运行时，这些运行时的出现使得 WASM 可以运行在浏览器之外的客户端与服务器端这样的沙盒环境中。 为什么需要 WebAssembly ？ 不管是在浏览器还是 Node.js 这样的服务端中，JavaScript 都可以胜任，为什么还需要 WASM ？
主要是因为 JavaScript 的性能问题，本质上，JavaScript 没有静态的变量类型，导致执行引擎所做的编译优化(JIT Compiler)很可能失效。举个例子，JavaScript 代码中定义了一个函数并且包含一个局部变量，开始是它被赋予 Array 类型的值，执行到下一行代码时它又被赋予 Object 类型的值，JIT 编译器所做的优化也就失效了。也正是因为 JavaScript 本身的设计缺陷，导致这门编程语言的发展史变成了填坑史，即使是围绕 JavaScript 的开发生态越来越庞大，它在面对大型复杂项目是还是有点儿捉襟见肘。
当然，开发者为了解决 JavaScript 的性能问题也做了各种尝试，除了 WASM 还有一种优化 JavaScript 的优化子集：asm.js。与 WASM 一样，asm.js 也是一种编译目标，可读性比 WebAssembly 好，但是开发者必须强制使用静态类型，这导致并不是所有的开发者都能够接受；其次 acm.js 的代码还是需要经过“获取-解析-编译-优化”这些耗时的过程，而 WASM 则不用这些步骤，WASM 已经是原生的字节码，而且 WASM 也是静态类型的，这使得大多数优化在其初始编译时就已完成，所以 WebAssembly 比 asm."><meta name=description content="WebAssembly 是什么？ WebAssembly 简称 WASM，从字面上看，它是由 Web 和 Assembly 组成，可以理解为网络/浏览器汇编，这也表明这项技术的由来，即运行在浏览器内的汇编代码。但是，随着技术的迭代，WebAssembly 早已不局限于它最初的设计愿景。
WebAssembly 不完全是汇编语言，而是一种类似汇编字节码的指令格式标准，由 W3C 的 WASM 工作组和 ByteCode Aliance(字节码联盟)共同维护。它更像 LLVM-IR 那种比汇编语言更高一些抽象的中间语言，开发者不需要手写 WASM，而是选择使用其他高级语言（如 C、C++、Rust、Go、Python等）编写并编译为 WASM。 WebAssembly 已经不只局限于运行在浏览器上面，如今随着 WASM 生态圈的不断扩展，涌现出了各种与 WASM 兼容的运行时，这些运行时的出现使得 WASM 可以运行在浏览器之外的客户端与服务器端这样的沙盒环境中。 为什么需要 WebAssembly ？ 不管是在浏览器还是 Node.js 这样的服务端中，JavaScript 都可以胜任，为什么还需要 WASM ？
主要是因为 JavaScript 的性能问题，本质上，JavaScript 没有静态的变量类型，导致执行引擎所做的编译优化(JIT Compiler)很可能失效。举个例子，JavaScript 代码中定义了一个函数并且包含一个局部变量，开始是它被赋予 Array 类型的值，执行到下一行代码时它又被赋予 Object 类型的值，JIT 编译器所做的优化也就失效了。也正是因为 JavaScript 本身的设计缺陷，导致这门编程语言的发展史变成了填坑史，即使是围绕 JavaScript 的开发生态越来越庞大，它在面对大型复杂项目是还是有点儿捉襟见肘。
当然，开发者为了解决 JavaScript 的性能问题也做了各种尝试，除了 WASM 还有一种优化 JavaScript 的优化子集：asm.js。与 WASM 一样，asm.js 也是一种编译目标，可读性比 WebAssembly 好，但是开发者必须强制使用静态类型，这导致并不是所有的开发者都能够接受；其次 acm.js 的代码还是需要经过“获取-解析-编译-优化”这些耗时的过程，而 WASM 则不用这些步骤，WASM 已经是原生的字节码，而且 WASM 也是静态类型的，这使得大多数优化在其初始编译时就已完成，所以 WebAssembly 比 asm."><meta property="og:locale" content="en-us"><style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{background-color:#f8f8f8;border-left:2px solid;margin:40px;padding:10px 20px}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:85%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.signatures{font-family:permanent marker,Impact,Charcoal,sans-serif;font-size:3rem;margin-top:32px}.signatures a{text-decoration:none}.header-line{width:100%;height:3px;background-color:#000;margin:18px 0}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-date,.posts-title{font-size:1.2rem}.posts-line{margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px;margin-bottom:3px}.site-footer{margin-top:50px;margin-bottom:80px;display:flex;justify-content:flex-end;flex-wrap:wrap;padding:12px 0;border-width:3px;border-color:#000}.site-footer-item{margin-right:12px}@media screen and (max-width:600px){.site-header{display:none}.post-content{padding:0 12px}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}}.post-content img{max-width:100%;display:block;margin-left:auto;margin-right:auto;margin-top:12px}.post-header{margin-bottom:50px}.post-title{font-size:2.5rem;font-weight:600}.post-category{display:inline;font-weight:900;margin:0 4px;padding:2px 5px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}</style><style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style><link href=https://morven.life/index.xml rel=alternate type=application/rss+xml title="Morven's Life"><link href="https://fonts.googleapis.com/css?family=Arvo|Permanent+Marker|Bree+Serif" rel=stylesheet></head><body><article class="post 简体中文" id=article><div class=row><div class=col-xs-12><header class=post-header><h1 class=post-title>关于 WebAssembly，我们需要知道的事</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2023-01-27 00:00:00 UTC">27 Jan 2023</time></div><div class=col-xs-6><div class=post-author><a target=_blank href=https://morven.life/>@Morven's Life</a></div></div></div></header><div class="post-content markdown-body"><h2 id=webassembly-是什么>WebAssembly 是什么？</h2><p>WebAssembly 简称 WASM，从字面上看，它是由 Web 和 Assembly 组成，可以理解为网络/浏览器汇编，这也表明这项技术的由来，即运行在浏览器内的汇编代码。但是，随着技术的迭代，WebAssembly 早已不局限于它最初的设计愿景。</p><ol><li>WebAssembly 不完全是汇编语言，而是一种类似汇编字节码的指令格式标准，由 W3C 的 <a href=https://www.w3.org/wasm/>WASM 工作组</a>和 <a href=https://bytecodealliance.org/>ByteCode Aliance(字节码联盟)</a>共同维护。它更像 LLVM-IR 那种比汇编语言更高一些抽象的中间语言，开发者不需要手写 WASM，而是选择使用其他高级语言（如 C、C++、Rust、Go、Python等）编写并编译为 WASM。</li><li>WebAssembly 已经不只局限于运行在浏览器上面，如今随着 WASM 生态圈的不断扩展，涌现出了各种与 WASM 兼容的<a href=https://github.com/appcypher/awesome-wasm-runtimes>运行时</a>，这些运行时的出现使得 WASM 可以运行在浏览器之外的客户端与服务器端这样的沙盒环境中。</li></ol><h2 id=为什么需要-webassembly->为什么需要 WebAssembly ？</h2><p>不管是在浏览器还是 Node.js 这样的服务端中，JavaScript 都可以胜任，为什么还需要 WASM ？</p><p>主要是因为 JavaScript 的性能问题，本质上，JavaScript 没有静态的变量类型，导致执行引擎所做的编译优化(JIT Compiler)很可能失效。举个例子，JavaScript 代码中定义了一个函数并且包含一个局部变量，开始是它被赋予 Array 类型的值，执行到下一行代码时它又被赋予 Object 类型的值，JIT 编译器所做的优化也就失效了。也正是因为 JavaScript 本身的设计缺陷，导致这门编程语言的发展史变成了填坑史，即使是围绕 JavaScript 的开发生态越来越庞大，它在面对大型复杂项目是还是有点儿捉襟见肘。</p><p>当然，开发者为了解决 JavaScript 的性能问题也做了各种尝试，除了 WASM 还有一种优化 JavaScript 的优化子集：<a href=http://asmjs.org/>asm.js</a>。与 WASM 一样，asm.js 也是一种编译目标，可读性比 WebAssembly 好，但是开发者必须强制使用静态类型，这导致并不是所有的开发者都能够接受；其次 acm.js 的代码还是需要经过“获取-解析-编译-优化”这些耗时的过程，而 WASM 则不用这些步骤，WASM 已经是原生的字节码，而且 WASM 也是静态类型的，这使得大多数优化在其初始编译时就已完成，所以 WebAssembly 比 asm.js 与 原生 JavaScript 快很多。</p><h2 id=webassembly-的特性>WebAssembly 的特性</h2><p>WASM 有几个关键的设计特性使得它成为从出生就开始自带光环：</p><ul><li>可移植 - 前面也提到了 WASM 最初是为 Web 设计的，目前几乎所有主流的浏览器都提供对 WASM 的支持；此外 WASM 也是针对低级虚拟机架构而设计，其指令由物理机单独翻译成机器代码，这就意味着 WASM 二进制文件最终可以在各种操作系统和芯片架构的组合上运行，无论是 Linux、MacOS、Windows等操作系统，还是ARM、X86、Power等芯片架构中，甚至移动设备、物联网（IoT）设备都可以运行。</li><li>轻量切且高效 - 前面提到了 WASM 的静态类型和编译优化，使得它相对于 JavaScript 以及 asm.js 有着数倍的性能提升。这种性能上的优势也让 WASM 在浏览器之外的运行环境中带来复利，WASM 特别适合对冷启动有较高要求的 Serverless 应用场景；目前，Serverless 技术虽然可以帮助管理基础计算设施和分拨配资源，但是在冷启动的情况下，还是需要新的计算资源，从而带来额外的成本，而 WASM 模块的轻量高效特性使得冷启动的成本大大缩减。</li><li>安全 - WASM 运行在沙盒环境中，重视能力驱动的安全性，对主机系统资源（如文件系统，硬件等）的访问是受限制的，除非被授予明确的能力访问，所以 WASM 减少了攻击面，实现了多租户环境中不受信任的代码安全受限地执行。这种安全模式允许开发者使用插件和用户提交的代码来扩展现有的应用程序。</li><li>多语言支持 - WASM 是一种编译目标格式，它无关于编程语言，只要语言支持，开发者可以灵活地使用多种语言（如 C、C++、Rust、Go等）来构建 WASM。目前，在 <a href=https://redmonk.com/sogrady/2022/03/28/language-rankings-1-22/>RedMonk</a> 排名前 20 的编程语言几乎都在添加 WASM 的支持。</li></ul><h2 id=webassembly-使用场景>WebAssembly 使用场景</h2><ol><li>应用向浏览器端迁移</li></ol><p>WASM 之前，JavaScript 是浏览器端的主要编程语言，但由于 JavaScript 本身的性能问题，导致很多大型应用没有办法直接运行在浏览器端。而如今随着浏览器和前端框架对 WASM 的支持，使开发者更容易在浏览器中编译和执行其他流行语言，例如 C、C++、Rust、和 Go 等语言。甚至也出现了从 WASM 设计的语言，包括 AssemblyScript、Grain、Motoko等。还有些企业开始使用 WASM 将之前的桌面应用迁移到浏览器端，例如 Google Earth、Photoshop、AutoCAD 等等，还有一些成熟的视频和游戏项目，如 Unity WebGL、Unreal Engine等。随着 WASM 系统接口 <a href=https://wasi.dev/>WASI</a> 的不断完善，WASM 模块与操作系统之间的交将被标准化，WASM 程序将以一致的方式访问系统资源。</p><ol start=2><li>服务器端</li></ol><ul><li>Serverless - 无服务平台高度依赖优化的冷启动技术，所以 WASM 的轻量高效特性使得 WASM 运行时（如 WASMEdge）非常适合为下一代无服务器平台提供动力，这也使得 WASM 不断向边缘计算领域渗透。</li><li>边缘的数据分析和机器学习 - WASM 可移植性和高效特性使得它适合于应用在支持边缘的机器学习场景，WASM 机器学习模块可以部署在外形和计算能力差异很大的边缘设备上，数据计算接近于数据产生源，无论是运行在网络边缘还是设备边缘。</li><li>服务网格 - 利用 WASM 的灵活性可以将服务网格（如 Istio）的扩展能力从控制平面下沉到数据平面（如使用 WASM 扩展 Envoy），WASM 扩展本身运行在沙盒环境中，不会影响数据平面程序的运行，资源访问也是受限的。</li><li>平台扩展 - 得益于 WASM 的多语言支持和沙盒隔离技术， WASM 可以在现有的应用程序上提供一个可扩展的模型和执行第三方（可信或不可信）代码的能力。</li></ul><p>WASM 生态圈 Landscape：</p><p><img src=https://s2.loli.net/2023/01/28/bYBL13XViE2CWlR.png alt=wasm_landscape.png></p><h2 id=webassembly-与容器技术的融合>WebAssembly 与容器技术的融合</h2><p>相信随着技术的迭代，WASM 运行时将会与容器运行时一样成为云原生领域的“一等公民”，随着 WASI 的不断完善以及容器注册表(OCI Registry)对 WASM 程序模块的支持，WASM 也许会将应用程序的管理提高到新的高度，就像从虚拟机技术到容器的普及，WASM 或许会替代一部分容器技术的功能。借助于 WASM 的冷启动优化，WASM 容器将会非常适合寿命较短的无服务器和边缘工作负载；但是传统的 容器工作负载将致力于需要大量 I/O 或需要访问网络套接字的长期运行的服务（如缓存服务器）。</p><p>更进一步地讲，Kubernetes 这样主流的容器编排引擎与如何与 WASM 进行整合，虽然为时尚早，但是我们已经看到了例如 Krustlet、runwasi、Containerd WASM Shims 以及 crun 的 WASM 处理程序等项目的涌现，它们的目标都是将 WASM 提升为容器环境中的一等公民，将其作为 Kubernetes 新的运行时。</p></div><div class="row middle-xs"><div class=col-xs-12><div class=post-category><a href=https://morven.life/categories/note/>note</a></div><div class=post-category><a href=https://morven.life/categories/tech/>tech</a></div></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=site-footer><div class=site-footer-item><a href=https://morven.life/about/ target=_blank>About Me</a></div></div></div></div></article><script src=https://morven.life/js/lazyload.min.js></script>
<script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script></script></body></html>